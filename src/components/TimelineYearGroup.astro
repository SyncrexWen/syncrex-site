---
// src/components/timeline/TimelineYearGroup.astro

/**
 * TimelineYearGroup
 * This component renders a group of timeline items for a specific year.
 * It receives a list of posts for that year, groups them by month, and renders them in a structured format.
 * Each month is displayed with a header and a vertical line connecting the timeline items.
 * Props:
 * - year: The year for which the timeline items are being rendered.
 * - posts: An array of collection entries (blog posts or thoughts) that belong to the specified year.
 * - slugBase: A string that indicates the base path for the links in the timeline items (e.g., 'blogs' or 'thoughts').
 * Usage:
 * <TimelineYearGroup year={2024} posts={postsFor2024} slugBase="blogs" />
 */

import TimelineItem from './TimelineItem.astro';
import type { CollectionEntry } from 'astro:content';

interface Props {
  year: number;
  posts: CollectionEntry<any>[];
  slugBase: string;
}

const { year, posts, slugBase } = Astro.props;

const postsByMonth = posts.reduce<Record<number, CollectionEntry<'blogs' | 'thoughts'>[]>>((acc: any, post: any) => {
  const month = post.data.pubDate.getMonth();
  if (!acc[month]) acc[month] = [];
  acc[month].push(post);
  return acc;
}, {} as Record<number, CollectionEntry<'blogs' | 'thoughts'>[]>);

const sortedMonths = Object.keys(postsByMonth).map(Number).sort((a, b) => b - a);
---

<section class="relative animate-fade-in-up">

  <div class="sticky top-0 z-20 bg-white/60 backdrop-blur-md py-2 mb-4 -mx-4 px-4 rounded-b-xl transition-all">
    <div class="relative">
      <span class="text-xl font-bold text-slate-700 pl-1 inline-block mt-1">{year}</span>
    </div>
  </div>

  <div class="flex flex-col gap-6"> {sortedMonths.map((monthIndex) => {
      const monthPosts = postsByMonth[monthIndex];
      const monthName = new Date(2000, monthIndex).toLocaleString('en-US', { month: 'short' }).toUpperCase();

      return (
        <div class="flex relative group/month">

          <div class="w-14 flex-shrink-0 flex flex-col items-center pt-1">
            <span class="text-xs font-bold font-mono text-slate-400 tracking-wider">
              {monthName}
            </span>
            <div class="h-full w-[1px] bg-slate-100 mt-2 group-hover/month:bg-slate-200 transition-colors"></div>
          </div>

          <div class="flex-1 flex flex-col gap-2 pb-6"> {monthPosts.map((post) => (
              <TimelineItem post={post} slugBase={slugBase} />
            ))}
          </div>
        </div>
      );
    })}
  </div>
</section>
