---
// src/layouts/CollectionLayout.astro

/**
 * CollectionLayout
 * This layout is designed for displaying a collection of items (like blog posts or thoughts) grouped by year.
 * It takes a list of items, groups them by their publication year, and renders them using the TimelineYearGroup component.
 * The layout also includes a title and description for the collection, which can be provided in both Chinese and English.
 * Props:
 * - title: The title of the collection, which can be a bilingual string (either a simple string or an object with 'zh' and 'en' properties).
 * - description: A brief description of the collection, also supporting bilingual content.
 * - items: An array of content entries (blog posts or thoughts) that will be displayed in the timeline.
 * - slugBase: A string that indicates the base path for the links in the timeline items (e.g., 'blogs' or 'thoughts').
 */

import PageLayout from './PageLayout.astro';
import TimelineYearGroup from '../components/TimelineYearGroup.astro';
import type { CollectionEntry } from 'astro:content';

type BilingualString = string | { zh: string; en: string };

interface Props {
    title: BilingualString;
    description?: BilingualString;
    items: CollectionEntry<any>[];
    slugBase: string;
}

const { title, description, items, slugBase } = Astro.props;

const postsByYear: Record<number, typeof items> = items.reduce(
    (acc: Record<number, typeof items>, post: any) => {
        const year = post.data.pubDate.getFullYear();
        if (!acc[year]) acc[year] = [];
        acc[year].push(post);
        return acc;
    },
    {} as Record<number, typeof items>
);

const sortedYears = Object.keys(postsByYear)
    .map(Number)
    .sort((a, b) => b - a);
---

<PageLayout title={title} description={description}>
    <div class="w-full max-w-3xl mx-auto mt-8 relative">
        <div class="absolute left-[3.85rem] top-0 bottom-0 w-px bg-slate-100 -z-10 hidden sm:block">
        </div>

        <div class="flex flex-col gap-12">
            {
                sortedYears.map((year) => (
                    <TimelineYearGroup year={year} posts={postsByYear[year]} slugBase={slugBase} />
                ))
            }
        </div>

        {
            items.length === 0 && (
                <div class="text-center py-20 text-slate-400">
                    <p>No content found.</p>
                </div>
            )
        }
    </div>
</PageLayout>
