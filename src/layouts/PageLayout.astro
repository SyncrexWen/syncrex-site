---
// src/layouts/PageLayout.astro
import DefaultLayout from './DefaultLayout.astro';
import LanguageToggle from '../components/LanguageToggle.astro';

type BilingualString = string | { zh: string; en: string };

interface Props {
  title: BilingualString;
  description?: BilingualString;
  lockedLang?: 'zh' | 'en';
}

const { title, description, lockedLang } = Astro.props;

// 辅助函数：生成的类名必须与 BaseHead 中的 CSS 严格对应
const renderBilingual = (content: BilingualString) => {
  if (typeof content === 'string') return content;
  // 注意这里：类名对应 BaseHead 里的 .hidden-when-en / .hidden-when-zh
  return `
    <span class="hidden-when-en">${content.zh}</span>
    <span class="hidden-when-zh">${content.en}</span>
  `;
};

const titleHtml = renderBilingual(title);
const descHtml = description ? renderBilingual(description) : null;

// SEO Title 处理
const metaTitle = typeof title === 'string' ? title : title.zh; // 建议默认给中文，或者你之前的拼接逻辑
const metaDesc = typeof description === 'string' ? description : description?.zh;
---

<DefaultLayout title={metaTitle} description={metaDesc}>

  <div id="progress-container" class="fixed top-0 left-0 w-full h-1 z-[101] bg-transparent pointer-events-none">
    <div id="progress-bar" class="h-full bg-[#2d3748] w-0 transition-all duration-100 ease-out"></div>
  </div>

  <article class="w-full max-w-4xl mx-auto flex flex-col items-center relative z-10">

    <div class="w-full flex justify-end mb-8 px-2 sm:px-0">
      <LanguageToggle lockedLang={lockedLang} />
    </div>

    <h1
      class="text-4xl md:text-5xl lg:text-6xl font-black text-center text-slate-900 leading-[1.1] mb-6 max-w-3xl"
      set:html={titleHtml}
    />

    {descHtml && (
      <p
        class="text-xl md:text-2xl text-slate-500 text-center font-serif italic max-w-2xl leading-relaxed opacity-90"
        set:html={descHtml}
      />
    )}

    <hr class="w-24 border-t-4 border-slate-200 rounded-full my-12" />

    <div class="
      w-full max-w-3xl mx-auto
      prose prose-lg prose-slate
      /* ...其他样式保持不变... */
      prose-headings:font-bold prose-headings:text-slate-800
      prose-p:text-justify prose-p:leading-loose
    ">
      <slot />
    </div>

    <div class="mt-20 pt-10 border-t border-slate-100 w-full max-w-2xl text-center">
      <p class="text-slate-400 text-sm tracking-wide font-medium uppercase">
        <span>Thanks for reading</span>
      </p>
      <div class="w-2 h-2 bg-slate-200 rounded-full mx-auto mt-4"></div>
    </div>

  </article>
</DefaultLayout>

